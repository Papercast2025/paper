<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Roboto&display=swap');
    
    body {
      background-color: #f0f0f0;
      color: #000;
      font-family: 'Roboto', Arial, sans-serif;
      margin: 0;
      padding: 0;
      width: 1440px;
      height: 2560px;
      -webkit-text-size-adjust: none;
    }
    .container {
      padding: 32px;
      display: flex;
      flex-direction: column;
      gap: 28px;
    }
    /* Utility class for row layout */
    .row {
      flex-direction: row !important;
      align-items: center;
      justify-content: center;
    }
    /* Force AQI children inline and prevent wrapping */
    #aqi-content {
      white-space: nowrap;
    }
    #aqi-content > div {
      display: inline-block;
      vertical-align: middle;
      padding: 10px;
      margin-top: 0;
      position: relative;
    }
    /* Card frame */
    .section {
      border: 4px solid #000;
      padding: 16px;
      border-radius: 8px;
      background-color: #fff;
      display: flex;
      flex-direction: column;
      position: relative;
    }
    /* Card header */
    .card-title {
      font-size: 36px;
      font-weight: bold;
      background-color: #000;
      color: #fff;
      padding: 4px 8px;
      margin-bottom: 8px;
      text-align: left;
    }
    /* River header: left aligned */
    .river-header {
      background-color: black;
      color: white;
      font-size: 36px;
      font-weight: bold;
      padding: 10px 8px;
      text-align: left;
      margin-bottom: 8px;
    }
    /* Centered sections */
    .centered .section-content {
      align-items: center;
      text-align: center;
    }
    .section-content {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      text-align: right;
    }
    .value {
      font-size: 100px;
      font-weight: bold;
      margin: 10px 0;
    }
    .label {
      font-size: 32px;
      color: #444;
    }
    .timestamp, .card-timestamp {
      font-size: 24px;
      color: #222;
      margin-top: 8px;
      text-align: right;
    }
    /* Hide old river measurement element */
    #river-stage { display: none; }
    /* River graph container */
    #river-graph {
      background-color: #cccccc;
      display: block;
      margin: 12px auto 0 auto;
      position: relative;
      width: 1001px;
      padding-left: calc(5% - 4px);
    }
    /* USGS site info: full black */
    #usgs-site-info {
      width: 100%;
      text-align: right;
      font-size: 20px;
      color: #000;
      margin-top: 8px;
    }
    /* Flood status styling */
    #flood-status {
      font-weight: bold;
      font-size: 48px;
      margin-top: 8px;
      display: inline-block;
      text-align: center;
    }
    /* Y-axis label styling */
    #y-axis-label {
      font-size: 18px;
      font-weight: bold;
      fill: black;
      text-anchor: start;
      transform: rotate(-90 25,170);
    }
    /* Header styling */
    #header {
      background-color: black;
      color: white;
      padding: 20px;
      text-align: center;
      font-size: 43px;
      font-weight: bold;
    }
    #header a { color: white; text-decoration: underline; }
    /* Weather Conditions: two-column layout */
    #weather-section .section-content {
      flex-direction: row;
      justify-content: space-between;
      width: 100%;
    }
    #weather-temp-container {
      display: flex;
      align-items: center;
      text-align: left;
    }
    /* Increase weather icon size by 20% (to 126×126) */
    #weather-icon { width: 126px; height: 126px; }
    #weather-temp-F { font-size: 100px; font-weight: bold; }
    #weather-temp-C { font-size: 50px; font-weight: bold; }
    #weather-details { text-align: right; }
    #weather-details div { font-size: 40px; font-weight: bold; }
    /* Sunrise/Sunset container: margin-left = 60px */
    #sunrise-sunset {
      display: inline-block;
      vertical-align: middle;
      margin-left: 60px;
      font-size: 36px;
      font-weight: bold;
      color: #000;
    }
    /* Alerts text */
    #alert-message {
      font-weight: bold;
      white-space: pre-wrap;
    }
    /* AQI Section – children inline */
    #aqi-classification, #aqi-measurement {
      font-size: 43px;
      font-weight: bold;
      color: black;
      margin-top: 0;
    }
    /* Hydration message */
    #hydration-message {
      font-size: 32px;
      text-align: center;
      margin-top: 10px;
      color: #000;
    }
    /* Water Bottle icon */
    #water-bottle {
      display: inline-block;
      vertical-align: middle;
      margin-right: 10px;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <div id="header">
    Chatham County Parks and Recreation (<span id="header-lat">35.77659</span> / <span id="header-lon">-79.14597</span>)
    <a href="https://www.chathamcountync.gov/parks-recreation" target="_blank">www.chathamcountync.gov/parks-recreation</a>
  </div>
  <div class="container">
    <!-- Heat Risk Section -->
    <div class="section centered" id="heat-risk-section">
      <div class="card-title">Heat Risk</div>
      <div class="section-content row" id="heat-risk-content">
        <div id="water-bottle"></div>
        <div class="value" id="heat-risk-level">--</div>
      </div>
      <div id="hydration-message">Remember to hydrate and take breaks in the shade!</div>
      <div class="card-timestamp" id="heat-risk-timestamp">Last updated: --</div>
    </div>

    <!-- Alerts Section -->
    <div class="section centered" id="alerts-section">
      <div class="card-title">Alerts</div>
      <div class="section-content">
        <div class="label" id="alert-message">No alerts at this time.</div>
      </div>
      <div class="card-timestamp" id="alerts-timestamp">Last updated: --</div>
    </div>

    <!-- Weather Conditions Section -->
    <div class="section centered" id="weather-section">
      <div class="card-title">Weather Conditions</div>
      <div class="section-content">
        <div id="weather-temp-container">
          <div id="weather-icon" style="margin-right: 10px;"></div>
          <div>
            <div id="weather-temp-F">--°F</div>
            <div id="weather-temp-C">--°C</div>
          </div>
          <div id="sunrise-sunset"></div>
        </div>
        <div id="weather-details">
          <div id="weather-forecast">--</div>
          <div id="weather-wind">Wind: -- mph</div>
          <div id="weather-humidity">Humidity: --%</div>
        </div>
      </div>
      <div class="card-timestamp" id="weather-timestamp">Last updated: --</div>
    </div>

    <!-- River & Water Levels Section -->
    <div class="section" id="river-section">
      <div class="river-header">River & Water Levels</div>
      <div class="section-content" style="margin-top: 56px; padding: 0 16px; text-align: center;">
        <div class="label" id="flood-status"></div>
      </div>
      <div id="river-graph"></div>
      <div id="usgs-site-info">USGS Site #02096960 (Live)</div>
      <div class="card-timestamp" id="river-timestamp">Last updated: --</div>
    </div>

    <!-- AQI Section -->
    <div class="section centered" id="aqi-section">
      <div class="card-title">Air Quality Index</div>
      <div class="section-content" id="aqi-content">
        <div id="aqi-classification">GOOD</div>
        <div id="aqi-gauge-container"></div>
        <div id="aqi-measurement">AQI: 42</div>
      </div>
      <div class="card-timestamp" id="aqi-timestamp">Last updated: --</div>
    </div>

    <!-- Rainfall Forecast Section -->
    <div class="section centered" id="rainfall-forecast">
      <div class="card-title">Rainfall Forecast</div>
      <div class="section-content">
        <div class="label" id="rainfall-forecast-1">--</div>
        <div class="label" id="rainfall-forecast-2">--</div>
        <div class="label" id="rainfall-forecast-3">--</div>
      </div>
      <div class="card-timestamp" id="rainfall-timestamp">Last updated: --</div>
    </div>
  </div>
  
  <script>
    /* ============== GLOBALS ============== */
    let LAT = 35.77659;
    let LON = -79.14597;
    document.getElementById('header-lat').textContent = LAT;
    document.getElementById('header-lon').textContent = LON;
    const AIRNOW_API_KEY = '26158E56-5836-46D3-B819-92969016332B';
    let floodThreshold = 5.0;

    /* ============== SUNRISE AND SUNSET ============== */
    function fetchSunriseSunset() {
      const url = `https://api.sunrise-sunset.org/json?lat=${LAT}&lng=${LON}&formatted=0`;
      fetch(url)
        .then(res => res.json())
        .then(data => {
          if (data.status === "OK") {
            const sunriseUTC = new Date(data.results.sunrise);
            const sunsetUTC = new Date(data.results.sunset);
            const now = new Date();
            
            // Convert UTC times to local time
            const sunriseLocal = new Date(sunriseUTC.getTime() - (sunriseUTC.getTimezoneOffset() * 60000));
            const sunsetLocal = new Date(sunsetUTC.getTime() - (sunsetUTC.getTimezoneOffset() * 60000));
            
            // Determine the next event (sunrise or sunset)
            const isDayTime = now >= sunriseLocal && now < sunsetLocal;
            
            // Show the next event based on current time
            let nextEvent = '';
            let nextTime = '';

            if (isDayTime) {
              // Daytime, sunset is next
              nextEvent = 'Sunset';
              nextTime = formatTime(sunsetLocal);
            } else {
              // Nighttime, sunrise is next
              nextEvent = 'Sunrise';
              nextTime = formatTime(sunriseLocal);
            }

            // Display the next event and time
            const sunriseSunsetText = `Next: ${nextEvent} at ${nextTime}`;
            document.getElementById("sunrise-sunset").innerHTML = sunriseSunsetText;
          }
        })
        .catch(err => console.error("Sunrise/Sunset fetch error:", err));
    }

    // Function to format time in local time format (HH:mm)
    function formatTime(date) {
      const options = { hour: '2-digit', minute: '2-digit', hour12: true };
      return date.toLocaleTimeString(undefined, options);
    }

    /* ============== MASTER REFRESH ============== */
    function fetchAllData() {
      fetchSunriseSunset();
      // Add your other fetch calls (AQI, weather, river, etc.) here
    }

    window.onload = fetchAllData;
    setInterval(fetchAllData, 10 * 60 * 1000);  // Refresh every 10 minutes
  </script>
</body>
</html>
