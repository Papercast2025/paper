<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=1440, initial-scale=1.0" />
  <title>Environmental Snapshot</title>
  <style>
    body {
      background-color: #ffffff;
      color: #000000;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      width: 1440px;
      height: 2560px;
      -webkit-text-size-adjust: none;
    }
    .container {
      padding: 32px;
      display: flex;
      flex-direction: column;
      gap: 28px;
    }
    .section {
      border: 2px solid #000;
      padding: 16px;
      border-radius: 8px;
      background-color: #ffffff;
      display: flex;
      flex-direction: column;
      position: relative;
    }
    /* Card headers: left aligned with white text on black background */
    .card-title {
      font-size: 36px;
      font-weight: bold;
      background-color: black;
      color: white;
      padding: 4px 8px;
      margin-bottom: 8px;
      text-align: left;
    }
    /* For sections to be centered, override section-content */
    .centered .section-content {
      align-items: center;
      text-align: center;
    }
    .section-content {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      text-align: right;
    }
    .value {
      font-size: 100px;
      font-weight: bold;
      margin: 10px 0;
    }
    .label {
      font-size: 32px;
      color: #444;
    }
    .timestamp {
      font-size: 24px;
      color: #222;
      margin-top: 20px;
      text-align: center;
    }
    /* Center the river graph container */
    #river-graph {
      display: block;
      margin: 12px auto 0 auto;
    }
    /* USGS site info styling (bottom of river card, right aligned) */
    #usgs-site-info {
      width: 100%;
      text-align: right;
      font-size: 20px;
      color: #666;
      margin-top: 8px;
    }
    /* Flood status text styling remains unchanged */
    #flood-status {
      font-weight: bold;
      text-align: center;
      width: 100%;
      font-size: 32px;
      margin-top: 8px;
    }
  </style>
</head>
<body>
  <div style="background-color: black; color: white; padding: 20px; text-align: center; font-size: 48px; font-weight: bold;">
    Chatham County
  </div>
  <div class="container">
    <!-- River & Water Levels Section (content remains left aligned) -->
    <div class="section" id="river-section">
      <div class="card-title" style="position: absolute; top: 16px; left: 16px;">
        River & Water Levels
      </div>
      <div class="section-content" style="margin-top: 56px; padding: 0 16px;">
        <div class="value" id="river-stage">Loading...</div>
        <!-- Dynamic flood status text -->
        <div class="label" id="flood-status"></div>
      </div>
      <div id="river-graph"></div>
      <div id="usgs-site-info">USGS Site #02096960 (Live)</div>
    </div>

    <!-- Alerts Section (centered) -->
    <div class="section centered" id="alerts-section">
      <div class="card-title">Alerts</div>
      <div class="section-content">
        <div class="label" id="alert-message">No alerts at this time.</div>
      </div>
    </div>

    <!-- Weather Conditions Section (centered) -->
    <div class="section centered" id="weather-section">
      <div class="card-title">Weather Conditions</div>
      <div id="weather-icon"></div>
      <div class="section-content">
        <div class="value" id="weather-temp">--</div>
        <div class="label" id="weather-forecast">--</div>
        <div class="label" id="weather-wind">--</div>
        <div class="label" id="weather-humidity">--</div>
      </div>
    </div>

    <!-- Rainfall Forecast Section (centered) -->
    <div class="section centered" id="rainfall-forecast">
      <div class="card-title">Rainfall Forecast</div>
      <div class="section-content">
        <div class="label" id="rainfall-forecast-1">--</div>
        <div class="label" id="rainfall-forecast-2">--</div>
        <div class="label" id="rainfall-forecast-3">--</div>
      </div>
    </div>

    <!-- Precipitation Section (centered) -->
    <div class="section centered" id="precipitation-section">
      <div class="card-title">Precipitation (24h)</div>
      <div class="section-content">
        <div class="value" id="precip-value">--</div>
        <div class="label">Last 24 Hours</div>
      </div>
    </div>

    <!-- Air Quality Index (AQI) Section (centered) -->
    <div class="section centered" id="aqi-section">
      <div class="card-title">Air Quality Index</div>
      <div id="aqi-icon"></div>
      <div class="section-content">
        <div class="value" id="aqi-value">--</div>
        <div class="label" id="aqi-category">Loading...</div>
        <div class="label" id="aqi-pollutant">Primary Pollutant: --</div>
      </div>
    </div>

    <!-- Timestamp Section (centered) -->
    <div class="timestamp">
      Last updated:<br />
      AQI: <span id="last-aqi-update">Loading...</span> |
      Weather & Forecast: <span id="last-nws-update">Loading...</span> |
      River: <span id="last-river-update">Loading...</span>
    </div>
    <div class="timestamp">
      For more information, visit <a href="https://www.chathamcountync.gov/" target="_blank">chathamcountync.gov</a>
    </div>
  </div>

  <script>
    const AIRNOW_API_KEY = '26158E56-5836-46D3-B819-92969016332B';
    const LAT = 35.77659;
    const LON = -79.14597;
    
    // Global flood threshold (default 5.0 ft)
    let floodThreshold = 5.0;

    // --- Helper functions for icons ---

    // Returns an inline SVG for weather conditions based on the forecast string
    function getWeatherIcon(forecast) {
      forecast = forecast.toLowerCase();
      let iconSVG = "";
      if (forecast.includes("sunny") || forecast.includes("clear")) {
        // Sun icon
        iconSVG = `<svg width="100" height="100" viewBox="0 0 64 64">
                     <circle cx="32" cy="32" r="12" fill="orange"/>
                     <g stroke="orange" stroke-width="2">
                       <line x1="32" y1="4" x2="32" y2="14"/>
                       <line x1="32" y1="50" x2="32" y2="60"/>
                       <line x1="4" y1="32" x2="14" y2="32"/>
                       <line x1="50" y1="32" x2="60" y2="32"/>
                       <line x1="12" y1="12" x2="18" y2="18"/>
                       <line x1="46" y1="46" x2="52" y2="52"/>
                       <line x1="12" y1="52" x2="18" y2="46"/>
                       <line x1="46" y1="18" x2="52" y2="12"/>
                     </g>
                   </svg>`;
      } else if (forecast.includes("cloud")) {
        // Cloud icon
        iconSVG = `<svg width="100" height="100" viewBox="0 0 64 64">
                     <path d="M20,40a12,12 0 0,1 24,0h8a8,8 0 0,0 0-16 10,10 0 0,0-19-4 12,12 0 0,0-19,4 8,8 0 0,0 0,16z" fill="gray"/>
                   </svg>`;
      } else if (forecast.includes("rain")) {
        // Rain icon
        iconSVG = `<svg width="100" height="100" viewBox="0 0 64 64">
                     <path d="M20,40a12,12 0 0,1 24,0h8a8,8 0 0,0 0-16 10,10 0 0,0-19-4 12,12 0 0,0-19,4 8,8 0 0,0 0,16z" fill="gray"/>
                     <g stroke="blue" stroke-width="2">
                       <line x1="22" y1="48" x2="22" y2="58"/>
                       <line x1="32" y1="48" x2="32" y2="58"/>
                       <line x1="42" y1="48" x2="42" y2="58"/>
                     </g>
                   </svg>`;
      } else if (forecast.includes("snow")) {
        // Snow icon
        iconSVG = `<svg width="100" height="100" viewBox="0 0 64 64">
                     <path d="M20,40a12,12 0 0,1 24,0h8a8,8 0 0,0 0-16 10,10 0 0,0-19-4 12,12 0 0,0-19,4 8,8 0 0,0 0,16z" fill="lightblue"/>
                     <g stroke="blue" stroke-width="2">
                       <line x1="32" y1="48" x2="32" y2="60"/>
                       <line x1="26" y1="52" x2="38" y2="52"/>
                     </g>
                   </svg>`;
      } else {
        // Default: partly cloudy
        iconSVG = `<svg width="100" height="100" viewBox="0 0 64 64">
                     <circle cx="22" cy="22" r="10" fill="orange"/>
                     <path d="M20,40a12,12 0 0,1 24,0h8a8,8 0 0,0 0-16 10,10 0 0,0-19-4 12,12 0 0,0-19,4 8,8 0 0,0 0,16z" fill="gray"/>
                   </svg>`;
      }
      return iconSVG;
    }

    // Returns an inline SVG for AQI based on the category name
    function getAQIIcon(category) {
      category = category.toLowerCase();
      let iconSVG = "";
      if (category.includes("good")) {
        iconSVG = `<svg width="100" height="100" viewBox="0 0 64 64">
                     <circle cx="32" cy="32" r="30" fill="green"/>
                     <text x="32" y="42" font-size="24" fill="white" text-anchor="middle" font-family="Arial">G</text>
                   </svg>`;
      } else if (category.includes("moderate")) {
        iconSVG = `<svg width="100" height="100" viewBox="0 0 64 64">
                     <circle cx="32" cy="32" r="30" fill="yellow"/>
                     <text x="32" y="42" font-size="24" fill="black" text-anchor="middle" font-family="Arial">M</text>
                   </svg>`;
      } else if (category.includes("unhealthy for sensitive groups")) {
        iconSVG = `<svg width="100" height="100" viewBox="0 0 64 64">
                     <circle cx="32" cy="32" r="30" fill="orange"/>
                     <text x="32" y="42" font-size="20" fill="black" text-anchor="middle" font-family="Arial">USG</text>
                   </svg>`;
      } else if (category.includes("unhealthy")) {
        iconSVG = `<svg width="100" height="100" viewBox="0 0 64 64">
                     <circle cx="32" cy="32" r="30" fill="red"/>
                     <text x="32" y="42" font-size="24" fill="white" text-anchor="middle" font-family="Arial">U</text>
                   </svg>`;
      } else if (category.includes("very unhealthy")) {
        iconSVG = `<svg width="100" height="100" viewBox="0 0 64 64">
                     <circle cx="32" cy="32" r="30" fill="purple"/>
                     <text x="32" y="42" font-size="24" fill="white" text-anchor="middle" font-family="Arial">VU</text>
                   </svg>`;
      } else if (category.includes("hazardous")) {
        iconSVG = `<svg width="100" height="100" viewBox="0 0 64 64">
                     <circle cx="32" cy="32" r="30" fill="maroon"/>
                     <text x="32" y="42" font-size="24" fill="white" text-anchor="middle" font-family="Arial">H</text>
                   </svg>`;
      } else {
        iconSVG = `<svg width="100" height="100" viewBox="0 0 64 64">
                     <circle cx="32" cy="32" r="30" fill="gray"/>
                     <text x="32" y="42" font-size="24" fill="white" text-anchor="middle" font-family="Arial">N/A</text>
                   </svg>`;
      }
      return iconSVG;
    }

    // --- River Data & Graph ---
    function fetchRiverData() {
      const end = new Date();
      const start = new Date();
      // 4 days of data
      start.setDate(end.getDate() - 4);

      const format = d => d.toISOString().split('.')[0];
      const url = `https://waterservices.usgs.gov/nwis/iv/?format=json&sites=02096960&parameterCd=00065&startDT=${format(start)}&endDT=${format(end)}&siteStatus=all`;
      
      fetch(url)
        .then(res => res.json())
        .then(data => {
          // Try to extract flood stage from API metadata (if available)
          const siteProps = data.value.timeSeries[0].sourceInfo.siteProperty;
          if (siteProps) {
            siteProps.forEach(prop => {
              if (prop.propertyName === "floodStage") {
                floodThreshold = parseFloat(prop.value);
              }
            });
          }
          // Convert raw data to array of { dateTime, stage }
          const rawValues = data.value.timeSeries[0].values[0].value || [];
          const floatValues = rawValues
            .map(v => ({
              dateTime: v.dateTime,
              stage: parseFloat(v.value)
            }))
            .filter(pt => !isNaN(pt.stage));

          if (floatValues.length === 0) {
            document.getElementById('river-stage').textContent = 'No data available';
            return;
          }

          // Current stage = last reading
          const lastReading = floatValues[floatValues.length - 1].stage;
          document.getElementById('river-stage').textContent = `${lastReading.toFixed(2)} ft`;
          document.getElementById("last-river-update").textContent = new Date().toLocaleString(undefined, {
            dateStyle: 'short',
            timeStyle: 'short'
          });

          // Update flood status label based on current stage vs flood threshold
          const statusEl = document.getElementById("flood-status");
          if (lastReading >= floodThreshold) {
            statusEl.textContent = "AT OR ABOVE FLOOD STAGE";
          } else {
            statusEl.textContent = "Below Flood Stage";
          }

          // Group measurements into 3-hour blocks and render graph
          const groupedValues = groupBy3HourBlocks(floatValues);
          renderRiverGraph(groupedValues, floodThreshold);
        })
        .catch(err => {
          console.error('USGS River Data fetch error:', err);
          document.getElementById('river-stage').textContent = 'Error fetching data';
        });
    }

    // Group measurements into 3-hour blocks and average each block
    function groupBy3HourBlocks(dataArray) {
      const blockMap = {};
      dataArray.forEach(pt => {
        const date = new Date(pt.dateTime);
        const y = date.getFullYear();
        const m = date.getMonth();
        const d = date.getDate();
        const hBlock = Math.floor(date.getHours() / 3) * 3;
        const blockDate = new Date(y, m, d, hBlock, 0, 0, 0);
        const key = blockDate.toISOString();
        if (!blockMap[key]) {
          blockMap[key] = { dateObj: blockDate, sum: 0, count: 0 };
        }
        blockMap[key].sum += pt.stage;
        blockMap[key].count += 1;
      });
      return Object.values(blockMap)
        .map(item => ({ dateObj: item.dateObj, stage: item.sum / item.count }))
        .sort((a, b) => a.dateObj - b.dateObj);
    }

    function renderRiverGraph(dataPoints, floodThreshold) {
      const container = document.getElementById("river-graph");
      container.innerHTML = "";

      // Ensure floodThreshold is included in min/max calculations
      let minStage = Math.min(...dataPoints.map(d => d.stage));
      let maxStage = Math.max(...dataPoints.map(d => d.stage));
      minStage = Math.min(minStage, floodThreshold);
      maxStage = Math.max(maxStage, floodThreshold);
      const stageRange = (maxStage - minStage) || 1;

      const minDate = dataPoints[0].dateObj;
      const maxDate = dataPoints[dataPoints.length - 1].dateObj;
      const totalMillis = maxDate - minDate;

      // Dimensions: 1152 x 280
      const svgWidth = 1152;
      const svgHeight = 280;
      const graphHeight = 180;
      const graphOffsetX = 60;
      const graphWidth = svgWidth - graphOffsetX - 20;
      const axisLabelY = 260; // "Date" axis label y-coordinate
      const dateLabelY = 240; // Y coordinate for one day marker; first day skipped

      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", svgWidth);
      svg.setAttribute("height", svgHeight);
      svg.setAttribute("viewBox", `0 0 ${svgWidth} ${svgHeight}`);

      // Y-axis tick marks at half-foot increments (font size increased to 18px)
      const startTick = Math.floor(minStage * 2) / 2;
      const endTick = Math.ceil(maxStage * 2) / 2;
      for (let tickVal = startTick; tickVal <= endTick; tickVal += 0.5) {
        const fraction = (maxStage - tickVal) / stageRange;
        const tickY = 20 + fraction * graphHeight;
        const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
        tick.setAttribute("x1", graphOffsetX - 5);
        tick.setAttribute("x2", graphOffsetX);
        tick.setAttribute("y1", tickY);
        tick.setAttribute("y2", tickY);
        tick.setAttribute("stroke", "black");
        tick.setAttribute("stroke-width", "1");
        svg.appendChild(tick);
        const tickLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        tickLabel.setAttribute("x", graphOffsetX - 10);
        tickLabel.setAttribute("y", tickY + 4);
        tickLabel.setAttribute("font-size", "18");
        tickLabel.setAttribute("fill", "black");
        tickLabel.setAttribute("text-anchor", "end");
        tickLabel.textContent = tickVal.toFixed(1) + " ft";
        svg.appendChild(tickLabel);
      }

      // Scale functions
      const scaleX = dateObj => {
        const currentMillis = dateObj - minDate;
        return graphOffsetX + (currentMillis / totalMillis) * graphWidth;
      };
      const scaleY = stage => {
        return graphHeight - ((stage - minStage) / stageRange) * graphHeight + 20;
      };

      // Build polyline path
      const pathData = dataPoints.map((pt, i) => {
        const x = scaleX(pt.dateObj);
        const y = scaleY(pt.stage);
        return (i === 0 ? 'M' : 'L') + x + ',' + y;
      }).join(' ');
      const polyline = document.createElementNS("http://www.w3.org/2000/svg", "path");
      polyline.setAttribute("d", pathData);
      polyline.setAttribute("stroke", "black");
      polyline.setAttribute("fill", "none");
      polyline.setAttribute("stroke-width", "3");
      svg.appendChild(polyline);

      // Draw Flood Stage dashed line (no label)
      const floodY = scaleY(floodThreshold);
      const floodLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
      floodLine.setAttribute("x1", graphOffsetX);
      floodLine.setAttribute("x2", graphOffsetX + graphWidth);
      floodLine.setAttribute("y1", floodY);
      floodLine.setAttribute("y2", floodY);
      floodLine.setAttribute("stroke", "black");
      floodLine.setAttribute("stroke-dasharray", "6,3");
      floodLine.setAttribute("stroke-width", "2");
      svg.appendChild(floodLine);

      // X-axis label "Date" (font size 21px)
      const xAxisLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
      xAxisLabel.setAttribute("x", svgWidth / 2);
      xAxisLabel.setAttribute("y", axisLabelY);
      xAxisLabel.setAttribute("font-size", "21");
      xAxisLabel.setAttribute("fill", "black");
      xAxisLabel.setAttribute("text-anchor", "middle");
      xAxisLabel.textContent = "Date";
      svg.appendChild(xAxisLabel);

      // Draw circles for each point and add one day marker per day (skip first day label)
      const minDateLabel = minDate.toLocaleDateString(undefined, { month: 'short', day: 'numeric' });
      let lastDay = "";
      dataPoints.forEach(pt => {
        const x = scaleX(pt.dateObj);
        const y = scaleY(pt.stage);
        const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        circle.setAttribute("cx", x);
        circle.setAttribute("cy", y);
        circle.setAttribute("r", 3);
        circle.setAttribute("fill", "black");
        svg.appendChild(circle);
        const dayLabel = pt.dateObj.toLocaleDateString(undefined, { month: 'short', day: 'numeric' });
        if (dayLabel !== minDateLabel && dayLabel !== lastDay) {
          lastDay = dayLabel;
          const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
          label.setAttribute("x", x);
          label.setAttribute("y", dateLabelY);
          label.setAttribute("font-size", "24");
          label.setAttribute("fill", "black");
          label.setAttribute("text-anchor", "middle");
          label.textContent = dayLabel;
          svg.appendChild(label);
        }
      });

      container.appendChild(svg);
    }

    // --- AQI Data ---
    function fetchAQIData() {
      const url = `https://www.airnowapi.org/aq/observation/latLong/current/?format=application/json&latitude=${LAT}&longitude=${LON}&distance=50&API_KEY=${AIRNOW_API_KEY}`;
      fetch(url)
        .then(res => res.json())
        .then(data => {
          if (data && data.length > 0) {
            const main = data[0];
            document.getElementById('aqi-value').textContent = main.AQI;
            document.getElementById('aqi-category').textContent = main.Category.Name;
            document.getElementById('aqi-pollutant').textContent = `Primary Pollutant: ${main.ParameterName}`;
            document.getElementById('last-aqi-update').textContent = new Date().toLocaleString();
            // Update AQI icon based on category
            document.getElementById('aqi-icon').innerHTML = getAQIIcon(main.Category.Name);
          } else {
            document.getElementById('aqi-value').textContent = "42";
            document.getElementById('aqi-category').textContent = "Good";
            document.getElementById('aqi-pollutant').textContent = "Primary Pollutant: PM2.5";
            document.getElementById('last-aqi-update').textContent = new Date().toLocaleString();
            document.getElementById('aqi-icon').innerHTML = getAQIIcon("Good");
          }
        })
        .catch(err => {
          console.error('Error fetching AQI data:', err);
          document.getElementById('aqi-value').textContent = "42";
          document.getElementById('aqi-category').textContent = "Good";
          document.getElementById('aqi-pollutant').textContent = "Primary Pollutant: PM2.5";
          document.getElementById('last-aqi-update').textContent = new Date().toLocaleString();
          document.getElementById('aqi-icon').innerHTML = getAQIIcon("Good");
        });
    }

    // --- Weather, Rainfall Forecast & Alerts from NWS ---
    function fetchNWSData() {
      document.getElementById('last-nws-update').textContent = new Date().toLocaleString(undefined, { dateStyle: 'medium', timeStyle: 'short' });
      const pointUrl = `https://api.weather.gov/points/${LAT},${LON}`;
      fetch(pointUrl)
        .then(res => res.json())
        .then(pointData => {
          const obsUrl = pointData.properties.forecastHourly;
          const gridUrl = pointData.properties.forecast;
          const alertZone = pointData.properties.forecastZone;
          
          // Weather Observations
          fetch(obsUrl)
            .then(res => res.json())
            .then(obsData => {
              if (obsData.properties && obsData.properties.periods && obsData.properties.periods.length > 0) {
                const now = obsData.properties.periods[0];
                const tempF = now.temperature;
                const tempC = ((tempF - 32) * 5/9).toFixed(1);
                document.getElementById('weather-temp').textContent = `${tempF ?? '--'}°F (${tempC}°C)`;
                document.getElementById('weather-forecast').textContent = now.shortForecast || 'N/A';
                document.getElementById('weather-wind').textContent = `Wind: ${now.windSpeed || '--'}`;
                const humidity = now.relativeHumidity && now.relativeHumidity.value ? now.relativeHumidity.value : '--';
                document.getElementById('weather-humidity').textContent = `Humidity: ${humidity}%`;
                if (now.quantitativePrecipitation && typeof now.quantitativePrecipitation.value === 'number') {
                  document.getElementById('precip-value').textContent = `${now.quantitativePrecipitation.value.toFixed(2)} in`;
                } else {
                  document.getElementById('precip-value').textContent = "0.00 in";
                }
                // Update weather icon based on shortForecast
                document.getElementById('weather-icon').innerHTML = getWeatherIcon(now.shortForecast);
              }
            })
            .catch(err => console.error('Error fetching weather observations:', err));

          // Rainfall Forecast
          fetch(gridUrl)
            .then(res => res.json())
            .then(gridData => {
              if (gridData.properties && gridData.properties.periods) {
                const days = gridData.properties.periods.slice(0, 3);
                document.getElementById('rainfall-forecast-1').textContent = `${days[0]?.name || 'Day1'}: ${days[0]?.shortForecast || 'N/A'}`;
                document.getElementById('rainfall-forecast-2').textContent = `${days[1]?.name || 'Day2'}: ${days[1]?.shortForecast || 'N/A'}`;
                document.getElementById('rainfall-forecast-3').textContent = `${days[2]?.name || 'Day3'}: ${days[2]?.shortForecast || 'N/A'}`;
              }
            })
            .catch(err => console.error('Error fetching rainfall forecast:', err));

          // Alerts
          if (alertZone) {
            const zoneId = alertZone.split('/').pop();
            const alertUrl = `https://api.weather.gov/alerts/active/zone/${zoneId}`;
            fetch(alertUrl)
              .then(res => res.json())
              .then(alertData => {
                if (alertData.features && alertData.features.length > 0) {
                  const alertMsg = alertData.features.map(a => a.properties.headline).join(' | ');
                  document.getElementById('alert-message').textContent = alertMsg;
                } else {
                  document.getElementById('alert-message').textContent = 'No alerts at this time.';
                }
              })
              .catch(err => console.error('Error fetching alerts:', err));
          }
        })
        .catch(err => console.error('Error fetching NWS points data:', err));
    }

    // --- Initial Fetch & Refresh ---
    fetchRiverData();
    fetchAQIData();
    fetchNWSData();

    // Refresh every 10 minutes
    setInterval(() => {
      fetchRiverData();
      fetchAQIData();
      fetchNWSData();
    }, 10 * 60 * 1000);

    // --- Icon Helper Functions ---
    function getWeatherIcon(forecast) {
      forecast = forecast.toLowerCase();
      let iconSVG = "";
      if (forecast.includes("sunny") || forecast.includes("clear")) {
        iconSVG = `<svg width="100" height="100" viewBox="0 0 64 64">
                     <circle cx="32" cy="32" r="12" fill="orange"/>
                     <g stroke="orange" stroke-width="2">
                       <line x1="32" y1="4" x2="32" y2="14"/>
                       <line x1="32" y1="50" x2="32" y2="60"/>
                       <line x1="4" y1="32" x2="14" y2="32"/>
                       <line x1="50" y1="32" x2="60" y2="32"/>
                       <line x1="12" y1="12" x2="18" y2="18"/>
                       <line x1="46" y1="46" x2="52" y2="52"/>
                       <line x1="12" y1="52" x2="18" y2="46"/>
                       <line x1="46" y1="18" x2="52" y2="12"/>
                     </g>
                   </svg>`;
      } else if (forecast.includes("cloud")) {
        iconSVG = `<svg width="100" height="100" viewBox="0 0 64 64">
                     <path d="M20,40a12,12 0 0,1 24,0h8a8,8 0 0,0 0-16 10,10 0 0,0-19-4 12,12 0 0,0-19,4 8,8 0 0,0 0,16z" fill="gray"/>
                   </svg>`;
      } else if (forecast.includes("rain")) {
        iconSVG = `<svg width="100" height="100" viewBox="0 0 64 64">
                     <path d="M20,40a12,12 0 0,1 24,0h8a8,8 0 0,0 0-16 10,10 0 0,0-19-4 12,12 0 0,0-19,4 8,8 0 0,0 0,16z" fill="gray"/>
                     <g stroke="blue" stroke-width="2">
                       <line x1="22" y1="48" x2="22" y2="58"/>
                       <line x1="32" y1="48" x2="32" y2="58"/>
                       <line x1="42" y1="48" x2="42" y2="58"/>
                     </g>
                   </svg>`;
      } else if (forecast.includes("snow")) {
        iconSVG = `<svg width="100" height="100" viewBox="0 0 64 64">
                     <path d="M20,40a12,12 0 0,1 24,0h8a8,8 0 0,0 0-16 10,10 0 0,0-19-4 12,12 0 0,0-19,4 8,8 0 0,0 0,16z" fill="lightblue"/>
                     <g stroke="blue" stroke-width="2">
                       <line x1="32" y1="48" x2="32" y2="60"/>
                       <line x1="26" y1="52" x2="38" y2="52"/>
                     </g>
                   </svg>`;
      } else {
        // Default: partly cloudy
        iconSVG = `<svg width="100" height="100" viewBox="0 0 64 64">
                     <circle cx="22" cy="22" r="10" fill="orange"/>
                     <path d="M20,40a12,12 0 0,1 24,0h8a8,8 0 0,0 0-16 10,10 0 0,0-19-4 12,12 0 0,0-19,4 8,8 0 0,0 0,16z" fill="gray"/>
                   </svg>`;
      }
      return iconSVG;
    }

    function getAQIIcon(category) {
      category = category.toLowerCase();
      let iconSVG = "";
      if (category.includes("good")) {
        iconSVG = `<svg width="100" height="100" viewBox="0 0 64 64">
                     <circle cx="32" cy="32" r="30" fill="green"/>
                     <text x="32" y="42" font-size="24" fill="white" text-anchor="middle" font-family="Arial">G</text>
                   </svg>`;
      } else if (category.includes("moderate")) {
        iconSVG = `<svg width="100" height="100" viewBox="0 0 64 64">
                     <circle cx="32" cy="32" r="30" fill="yellow"/>
                     <text x="32" y="42" font-size="24" fill="black" text-anchor="middle" font-family="Arial">M</text>
                   </svg>`;
      } else if (category.includes("unhealthy for sensitive groups")) {
        iconSVG = `<svg width="100" height="100" viewBox="0 0 64 64">
                     <circle cx="32" cy="32" r="30" fill="orange"/>
                     <text x="32" y="42" font-size="20" fill="black" text-anchor="middle" font-family="Arial">USG</text>
                   </svg>`;
      } else if (category.includes("unhealthy")) {
        iconSVG = `<svg width="100" height="100" viewBox="0 0 64 64">
                     <circle cx="32" cy="32" r="30" fill="red"/>
                     <text x="32" y="42" font-size="24" fill="white" text-anchor="middle" font-family="Arial">U</text>
                   </svg>`;
      } else if (category.includes("very unhealthy")) {
        iconSVG = `<svg width="100" height="100" viewBox="0 0 64 64">
                     <circle cx="32" cy="32" r="30" fill="purple"/>
                     <text x="32" y="42" font-size="24" fill="white" text-anchor="middle" font-family="Arial">VU</text>
                   </svg>`;
      } else if (category.includes("hazardous")) {
        iconSVG = `<svg width="100" height="100" viewBox="0 0 64 64">
                     <circle cx="32" cy="32" r="30" fill="maroon"/>
                     <text x="32" y="42" font-size="24" fill="white" text-anchor="middle" font-family="Arial">H</text>
                   </svg>`;
      } else {
        iconSVG = `<svg width="100" height="100" viewBox="0 0 64 64">
                     <circle cx="32" cy="32" r="30" fill="gray"/>
                     <text x="32" y="42" font-size="24" fill="white" text-anchor="middle" font-family="Arial">N/A</text>
                   </svg>`;
      }
      return iconSVG;
    }
  </script>
</body>
</html>
