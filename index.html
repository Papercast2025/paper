<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=1440, initial-scale=1.0">
  <title>Environmental Snapshot</title>
  <style>
    body {
      background-color: #ffffff;
      color: #000000;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      width: 1440px;
      height: 2560px;
      -webkit-text-size-adjust: none;
    }
    .container {
      padding: 32px;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      gap: 28px;
    }
    .section {
      border: 2px solid #000;
      padding: 16px;
      border-radius: 8px;
      background-color: #ffffff;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .section h2 {
      margin-top: 0;
      font-size: 48px;
      background-color: #000;
      color: #fff;
      padding: 10px;
      border-radius: 4px;
      flex: 1;
    }
    .section-content {
      flex: 2;
      padding-left: 20px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      text-align: right;
    }
    .value {
      font-size: 100px;
      font-weight: bold;
      margin: 10px 0;
    }
    .label {
      font-size: 32px;
      color: #444;
    }
    .timestamp {
      font-size: 28px;
      color: #222;
      margin-top: 40px;
      text-align: center;
    }
    .forecast-day {
      margin-top: 10px;
      font-size: 32px;
      text-align: right;
    }
    .alert {
      background-color: #ffcccc;
      border: 2px solid red;
      padding: 8px;
      margin: 5px 0;
      border-radius: 4px;
      font-size: 28px;
    }
  </style>
</head>
<body>
  <div class="container">

    <div class="section">
      <h2>Weather</h2>
      <div class="section-content">
        <div class="value" id="weather-temp">--</div>
        <div class="label" id="weather-description">Loading...</div>
        <div class="label" id="weather-wind">--</div>
        <div class="label" id="weather-humidity">--</div>
      </div>
    </div>

    <div class="section">
      <h2>Air Quality Index (AQI)</h2>
      <div class="section-content">
        <div class="value" id="aqi-value">--</div>
        <div class="label" id="aqi-category">Loading...</div>
        <div class="label" id="aqi-pollutant">Primary Pollutant: --</div>
      </div>
    </div>

    <div class="section">
      <h2>Heat Index</h2>
      <div class="section-content">
        <div class="value" id="heat-index">--</div>
        <div class="label">Feels Like</div>
      </div>
    </div>

    <div class="section">
      <h2>Forecast</h2>
      <div class="section-content" id="forecast">
        <div class="label">Loading...</div>
      </div>
    </div>

    <div class="section">
      <h2>Alerts</h2>
      <div class="section-content" id="alerts">
        <div class="label">Loading...</div>
      </div>
    </div>

    <div class="timestamp" id="last-updated">
      Loading...
    </div>
  </div>

  <script>
    const AIRNOW_API_KEY = '26158E56-5836-46D3-B819-92969016332B';
    const LAT = 35.7796;
    const LON = -78.6382;

    function setAQIContent(aqi, category, pollutant, fallback = false) {
      document.getElementById('aqi-value').textContent = aqi;
      document.getElementById('aqi-category').textContent = category + (fallback ? ' (fallback)' : '');
      document.getElementById('aqi-pollutant').textContent = `Primary Pollutant: ${pollutant}`;
    }

    function fetchAQIData() {
      const url = `https://www.airnowapi.org/aq/observation/latLong/current/?format=application/json&latitude=${LAT}&longitude=${LON}&distance=50&API_KEY=${AIRNOW_API_KEY}`;

      fetch(url)
        .then(response => response.json())
        .then(data => {
          if (data && data.length > 0) {
            const main = data[0];
            setAQIContent(main.AQI, main.Category.Name, main.ParameterName);
          } else {
            setAQIContent(42, 'Good', 'PM2.5', true);
          }
        })
        .catch(() => setAQIContent(42, 'Good', 'PM2.5', true));
    }

    function fetchWeatherAndAlerts() {
      fetch(`https://api.weather.gov/points/${LAT},${LON}`)
        .then(res => res.json())
        .then(meta => {
          const forecastUrl = meta.properties.forecast;
          const obsUrl = meta.properties.observationStations;
          const alertUrl = `https://api.weather.gov/alerts/active?point=${LAT},${LON}`;

          fetch(obsUrl)
            .then(res => res.json())
            .then(obsData => {
              const station = obsData.features[0].properties.stationIdentifier;
              return fetch(`https://api.weather.gov/stations/${station}/observations/latest`);
            })
            .then(res => res.json())
            .then(obs => {
              const temp = obs.properties.temperature.value;
              const desc = obs.properties.textDescription;
              const wind = obs.properties.windSpeed.value;
              const humidity = obs.properties.relativeHumidity.value;
              const heat = obs.properties.heatIndex.value;

              document.getElementById('weather-temp').textContent = temp ? `${Math.round(temp * 9/5 + 32)}°F` : '--';
              document.getElementById('weather-description').textContent = desc || '--';
              document.getElementById('weather-wind').textContent = wind ? `Wind: ${Math.round(wind * 0.621371)} mph` : '--';
              document.getElementById('weather-humidity').textContent = humidity ? `Humidity: ${Math.round(humidity)}%` : '--';
              document.getElementById('heat-index').textContent = heat ? `${Math.round(heat * 9/5 + 32)}°F` : '--';
            });

          fetch(alertUrl)
            .then(res => res.json())
            .then(alerts => {
              const alertContainer = document.getElementById('alerts');
              alertContainer.innerHTML = '';
              if (alerts.features.length > 0) {
                alerts.features.forEach(a => {
                  const div = document.createElement('div');
                  div.className = 'alert';
                  div.textContent = a.properties.headline;
                  alertContainer.appendChild(div);
                });
              } else {
                const noAlert = document.createElement('div');
                noAlert.className = 'label';
                noAlert.textContent = 'No active alerts';
                alertContainer.appendChild(noAlert);
              }
            });

          fetch(forecastUrl)
            .then(res => res.json())
            .then(data => {
              const periods = data.properties.periods.slice(0, 3);
              const forecastEl = document.getElementById('forecast');
              forecastEl.innerHTML = '';
              periods.forEach(p => {
                const div = document.createElement('div');
                div.className = 'forecast-day';
                div.textContent = `${p.name}: ${p.shortForecast} (${p.temperature}°F)`;
                forecastEl.appendChild(div);
              });
            });
        });
    }

    window.onload = () => {
      fetchAQIData();
      fetchWeatherAndAlerts();

      const now = new Date();
      document.getElementById('last-updated').textContent = `Last updated: ${now.toLocaleDateString()} ${now.toLocaleTimeString()}`;
    }
  </script>
</body>
</html>
